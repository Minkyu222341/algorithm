# NGINX란?
* 트래픽이 WAS를 도와주는 비동기 이벤트 기반구조의 웹서버 프로그램이다.
* 공식문서에서는 NGINX는 고성능, 확장성, 고가용성 웹서버, 역방향프록시 서버 및 웹 가속기(로드밸런서,캐시 등의 기능결합)이다.라고 하고있다.

 # Nginx의 등장배경
 * Nginx는 Was를 도와주는 웹 서버 프로그램이라고 하였다.
 * 아파치 서버는 요청이 들어오면 커넥션을 형성하기 위하여 프로세스를 생성한다.
 * 프로세스 생성 시간이 오래걸리므로 프로세스를 미리 만들어두는 PREFORK방식을 사용했고 이는 개발하기 쉽다는(확장성) 장점이있었다.
 * 덕분에 다양한 모듈을 만들어 빠르게 기능을 추가하고 동적컨텐츠를 처리 할 수 있게 되었다. 
 * 하지만 1999년 부터는 트래픽량이 높아져서 동시에 연결된 커넥션이 많아졌을 때 더이상 커넥션을 형성하지 못하는 문제가 생겼다.
 * 이를 C10K문제(Connection 10000 Problem)이라고 한다.
   * 아파치 서버는 다음과 같은 문제점이 있었다.
      * 커넥션마다 프로세스를 할당하기에 메모리 부족으로 이어진다.
      * 확장성이라는 장점이 프로세스의 리소스 양을 늘려서 무거운 프로그엠이 되었다.
      * 많은 커넥션에서 요청이 들어오면 CPU부하가 높아진다. (컨텍스트 스위칭을 많이하기에)
      * 즉 수많은 동시 커넥션을 감당하기엔 아파치 서버의 구조가 적합하지 않았다.
   * 이를 보완하기 위해 나온 소프트웨어가 Nginx인 것이다.
   * 수많은 커넥션을 Nginx가 유지하고 웹서버 이기에 정적 파일에대한 요청은 스스로 처리하며 부하를 줄였다.

# Nginx의 구조
![image](https://user-images.githubusercontent.com/108817236/210137849-d32b037c-e0ce-4f14-b18e-44c62c425802.png)
* Nginx는 설정파일을 읽고, 설정에 맞게 workerprocess를 생성하는 masterprocess가 있다.
* 실질적으로 요청을 처리하는 것은 workerprocess이다. 워커프로세스가 만들어 질 대 listen소켓을 배정받으며,
* 새로운 요청이 들어온다면 그 소켓에 커넥션을 형성하고 처리된다.
* 커넥션은 정해진 Keep-Alive시간만큼 유지된다. 
* 형성된 커넥션으로부터 아무런 요청이 없다면 새로운 커넥션을 형성하거나 이미 만들어진 다른 커넥션으로부터 들어온 요청을 처리한다.

# Nginx의 동작방식
![image](https://user-images.githubusercontent.com/108817236/210137576-6b60938c-fdaa-4c69-82b7-36d321df16d8.png)
![image](https://user-images.githubusercontent.com/108817236/210137961-522b9fa0-a370-49e2-ad6a-fb7eba4c9aab.png)

* Nginx는 요청을 비동기로 처리한다.
* 요청당 프로세스 또는 스레드를 생성하지 않고 하나의 Wokerprocess가 여러 요청을 처리한다.
* 이 이벤트들은 OS커널이 Queue 형식으로 워커프로세스에게 전달한다.
* Queue에 담긴 상태에서 비동기 상태로 대기하다가, 하나의 스레드로 이벤트를 꺼내서 처리해간다.
* 위의 이미지처럼 적은수의 프로세스, 그리고 프로세스 수는 일정하기에 컨텍스트스위칭이 적게 발생하며 이로인해 메모리를 적게 사용한다.

# Nginx의 장단점
### 장점
* 제한된 하드웨어 리소스로도 여러 클라이언트 요청을 효율적으로 처리 
* 단일스레드를 통해 여러 연결처리 가능
* 최소한의 리소스로 웹 서버의 아키텍처를 개선하기 위해 독립형 HTTP 서버로 배치 가능

### 단점
* 동적 컨텐츠를 기본적으로 처리 할 수 없음
* 동적 콘텐츠에 대한 PHP 및 기타 요청을 처리하려면 NGINX가이를 실행하기 위해 외부 프로세서로 전달하고 렌더링 된 콘텐츠가 다시 전송 될 때까지 기다려야함(프로세스 속도 저하).
* 즉, 동적 웹 페이지 컨텐츠를 가진 모든 요청을 위해 외부 자원과 연계(php-fpm)
